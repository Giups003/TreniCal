syntax = "proto3";

package trenical.ticket;

option java_multiple_files = true;
option java_package = "it.unical.trenical.grpc.ticket";
option java_outer_classname = "TicketServiceProto";

import "common.proto";
import "google/protobuf/timestamp.proto";

// Servizio per la gestione dei biglietti
service TicketService {
  // Acquisto biglietti
  rpc PurchaseTicket(PurchaseTicketRequest) returns (PurchaseTicketResponse);

  // Modifica biglietto
  rpc ModifyTicket(ModifyTicketRequest) returns (OperationResponse);

  // Annulla biglietto
  rpc CancelTicket(CancelTicketRequest) returns (OperationResponse);

  // Ottieni biglietto per ID
  rpc GetTicket(GetTicketRequest) returns (GetTicketResponse);

  // Lista biglietti per utente
  rpc ListTickets(ListTicketsRequest) returns (ListTicketsResponse);

  // Elimina tutti i biglietti (solo admin)
  rpc ClearAllTickets(ClearAllTicketsRequest) returns (OperationResponse);

  // Calcola il prezzo di un biglietto senza acquistarlo
  rpc GetTicketPrice(GetTicketPriceRequest) returns (GetTicketPriceResponse);
}

// Utilizziamo il messaggio Ticket definito in common.proto

// Richiesta per l'acquisto di un biglietto
message PurchaseTicketRequest {
  int32 train_id = 1; // Cambiato da string a int32
  string passenger_name = 2;
  string departure_station = 3;
  string arrival_station = 4;
  google.protobuf.Timestamp travel_date = 5;
  string service_class = 6; // Es: "Prima Classe", "Economy"
  string promo_code = 7; // Codice promozionale opzionale
  string payment_method = 8; // Es: "Carta di Credito", "PayPal"
  int32 seats = 9;
  google.protobuf.Timestamp travel_time = 10; // Orario di viaggio
  string train_type = 11; // tipologia treno
}

// Risposta per l'acquisto di un biglietto
message PurchaseTicketResponse {
  bool success = 1;
  string ticket_id = 2; // ID univoco del biglietto acquistato (primo biglietto)
  string message = 3; // Messaggio di conferma o errore
  double price = 4; // Prezzo calcolato del biglietto
  trenical.common.Ticket ticket = 5; // Dettagli del primo biglietto acquistato
  repeated trenical.common.Ticket tickets = 6; // Tutti i biglietti acquistati
}

// Richiesta per la modifica di un biglietto
message ModifyTicketRequest {
  string ticket_id = 1; // ID del biglietto da modificare
  google.protobuf.Timestamp new_travel_date = 2; // Nuova data di viaggio (opzionale)
  google.protobuf.Timestamp modification_date = 3; // Data della modifica (server-side, opzionale)
  string new_service_class = 4; // Nuova classe di servizio (opzionale)
  string new_departure_station = 5; // Nuova stazione di partenza (opzionale)
  string new_arrival_station = 6; // Nuova stazione di arrivo (opzionale)
  google.protobuf.Timestamp new_travel_time = 7; // Nuovo orario di viaggio (opzionale)
  int32 train_id = 8; // Nuovo ID treno (opzionale, aggiunto per supporto cambio treno)
  string train_type = 9; // Nuovo campo: tipologia treno
}

// Richiesta per annullare un biglietto
message CancelTicketRequest {
  string ticket_id = 1;
}

// Richiesta per ottenere un biglietto tramite ID
message GetTicketRequest {
  string ticket_id = 1;
}

// Risposta per ottenere un biglietto
message GetTicketResponse {
  bool success = 1;
  string message = 2;
  trenical.common.Ticket ticket = 3;
}

// Richiesta per ottenere la lista dei biglietti di un utente
message ListTicketsRequest {
  string passenger_name = 1;
}

// Risposta con la lista dei biglietti
message ListTicketsResponse {
  repeated trenical.common.Ticket tickets = 1;
}

// Risposta generica per le operazioni
message OperationResponse {
  bool success = 1; // Indica se l'operazione Ã¨ andata a buon fine
  string message = 2; // Messaggio di conferma o errore
  double old_price = 3;
  double new_price = 4;
  double penalty = 5;
  double tariff_diff = 6;
  double total = 7;
}

// Richiesta per eliminare tutti i biglietti
message ClearAllTicketsRequest {}

// Richiesta per il calcolo del prezzo di un biglietto
message GetTicketPriceRequest {
  string departure_station = 1;
  string arrival_station = 2;
  string service_class = 3;
  google.protobuf.Timestamp travel_date = 4;
  string promo_code = 5;
  string train_type = 6;
  string user_type = 7;
}

// Risposta per il calcolo del prezzo di un biglietto
message GetTicketPriceResponse {
  double price = 1;
}
